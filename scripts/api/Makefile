# Nom du projet
PROJECT_NAME=showroomprive_api
PORT=8000

# Fichier compose
COMPOSE=docker compose

.PHONY: build up down logs restart ps portkill

# Construire l'image
build:
	$(COMPOSE) build

# Lancer les services en arriÃ¨re-plan
up:
	$(COMPOSE) up -d

# ArrÃªter et supprimer les conteneurs
down:
	$(COMPOSE) down

# RedÃ©marrer
restart: down up

# Voir les logs de l'API
logs:
	$(COMPOSE) logs -f api

# Liste des conteneurs qui tournent
ps:
	$(COMPOSE) ps

# VÃ©rifie si le port est occupÃ© (par dÃ©faut 8000)
check-port:
	@echo "==> Ports Ã©coutÃ©s sur $(PORT)"
	@lsof -i :$(PORT) || echo "Port $(PORT) libre âœ…"

# Kill le process qui occupe le port 
portkill:
	@PID=$$(lsof -t -i :$(PORT)); \
	if [ -n "$$PID" ]; then \
	  echo "ðŸ”´ Port $(PORT) occupÃ© par PID $$PID. On kill..."; \
	  kill -9 $$PID; \
	else \
	  echo "âœ… Port $(PORT) libre"; \
	fi
# lancer l'api
api-run:
	uvicorn app.main:app --reload